(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1860],{202:(e,t,r)=>{"use strict";r.d(t,{v:()=>s});var l=r(86645);let n=e=>{let t,r=new Set,l=(e,l)=>{let n="function"==typeof e?e(t):e;if(!Object.is(n,t)){let e=t;t=(null!=l?l:"object"!=typeof n||null===n)?n:Object.assign({},t,n),r.forEach(r=>r(t,e))}},n=()=>t,i={setState:l,getState:n,getInitialState:()=>s,subscribe:e=>(r.add(e),()=>r.delete(e))},s=t=e(l,n,i);return i},i=e=>{let t=(e=>e?n(e):n)(e),r=e=>(function(e,t=e=>e){let r=l.useSyncExternalStore(e.subscribe,l.useCallback(()=>t(e.getState()),[e,t]),l.useCallback(()=>t(e.getInitialState()),[e,t]));return l.useDebugValue(r),r})(t,e);return Object.assign(r,t),r},s=e=>e?i(e):i},14879:(e,t,r)=>{Promise.resolve().then(r.bind(r,16724)),Promise.resolve().then(r.bind(r,97034)),Promise.resolve().then(r.bind(r,87086)),Promise.resolve().then(r.bind(r,32868)),Promise.resolve().then(r.t.bind(r,92044,23)),Promise.resolve().then(r.bind(r,57326))},16724:(e,t,r)=>{"use strict";r.d(t,{default:()=>N});var l=r(42289),n=r(98526),i=r(58508),s=r(43918),a=r(96565),u=r(71824),o=r(85675),c=r(91858),d=r(83241),f=r(55033),p=r(86339),m=r(30862),x=r(28454),v=r(6492),h=r(54577),b=r(39164),g=r(70381),y=r(58258),j=r(86645);function N(e){let{subscription:t}=e,r=(0,g.useTranslations)("subscribe"),{common:N}=(0,o.A)(),_=(0,y.useRouter)(),[w,S]=(0,j.useState)({quantity:1,subscribe_id:0,payment:-1,coupon:"",auth_type:"email",identifier:"",password:""}),[C,O]=(0,j.useTransition)(),[P,q]=(0,j.useState)({valid:!1,message:""}),{data:k}=(0,d.I)({enabled:!!(null==t?void 0:t.id)&&!!w.payment,queryKey:["preCreateOrder",w.coupon,w.quantity,w.payment],queryFn:async()=>{let{data:e}=await (0,c.NP)({...w,subscribe_id:null==t?void 0:t.id});return e.data}});(0,j.useEffect)(()=>{t&&S(e=>({...e,quantity:1,subscribe_id:null==t?void 0:t.id}))},[t]);let z=(0,j.useCallback)((e,t)=>{S(r=>({...r,[e]:t}))},[]),E=(0,j.useCallback)(async()=>{O(async()=>{try{let{data:e}=await (0,c.Ov)(w),{order_no:t}=e.data;t&&(localStorage.setItem(t,JSON.stringify({auth_type:w.auth_type,identifier:w.identifier})),_.push("/purchasing/order?order_no=".concat(t)))}catch(e){console.log(e)}})},[w,_]);return t?(0,l.jsxs)("div",{className:"mx-auto mt-8 flex max-w-4xl flex-col gap-8 md:grid md:grid-cols-2 md:flex-row",children:[(0,l.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,l.jsxs)(p.Zp,{children:[(0,l.jsxs)(p.aR,{children:["输入要用于 ",N.site.site_name," 账户的电子邮件地址"]}),(0,l.jsxs)(p.Wu,{className:"flex flex-col gap-2",children:[(0,l.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,l.jsx)(x.z,{className:(0,h.cn)({"border-destructive":!P.valid&&""!==w.identifier}),placeholder:"Email",type:"email",value:w.identifier||"",onValueChange:e=>{if(S(t=>({...t,identifier:e})),/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e))if(N.auth.email.enable_domain_suffix){var t;let r=e.split("@")[1];if(!(null==(t=N.auth.email)?void 0:t.domain_suffix_list.split("\n").includes(r||"")))return void q({valid:!1,message:"邮箱域名不在白名单中"})}else q({valid:!0,message:""});else q({valid:!1,message:"请输入有效的邮箱地址"})},required:!0}),(0,l.jsx)("p",{className:(0,h.cn)("text-muted-foreground text-xs",{"text-destructive":!P.valid&&""!==w.identifier}),children:P.message||"请填写您的电子邮件地址。"})]}),w.identifier&&P.valid&&(0,l.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,l.jsx)(x.z,{placeholder:"Password",type:"password",value:w.password||"",onValueChange:e=>z("password",e)}),(0,l.jsx)("p",{className:"text-muted-foreground text-xs",children:"如果您不填写密码，我们将会自动生成密码并发送到您的邮箱。"})]})]})]}),(0,l.jsx)(p.Zp,{children:(0,l.jsxs)(p.Wu,{className:"grid gap-3 p-6 text-sm",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold",children:t.name}),(0,l.jsx)("ul",{className:"flex flex-grow flex-col gap-3",children:(()=>{let e;try{e=JSON.parse(t.description)}catch(t){e={description:"",features:[]}}let{description:r,features:n}=e;return(0,l.jsxs)(l.Fragment,{children:[r&&(0,l.jsx)("li",{className:"text-muted-foreground",children:r}),null==n?void 0:n.map((e,t)=>(0,l.jsxs)("li",{className:(0,h.cn)("flex items-center gap-1",{"text-muted-foreground line-through":"destructive"===e.type}),children:[e.icon&&(0,l.jsx)(v.Icon,{icon:e.icon,className:(0,h.cn)("text-primary size-5",{"text-green-500":"success"===e.type,"text-destructive":"destructive"===e.type})}),e.label]},t))]})})()}),(0,l.jsx)(s._,{subscribe:{...t,quantity:w.quantity}}),(0,l.jsx)(m.w,{}),(0,l.jsx)(n.M,{order:{...k,quantity:w.quantity,unit_price:null==t?void 0:t.unit_price}})]})})]}),(0,l.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,l.jsx)(p.Zp,{children:(0,l.jsx)(p.Wu,{className:"p-6",children:(0,l.jsxs)("div",{className:"grid gap-6",children:[(0,l.jsx)(a.A,{quantity:w.quantity,unitTime:null==t?void 0:t.unit_time,discounts:null==t?void 0:t.discount,onChange:e=>z("quantity",e)}),(0,l.jsx)(i.A,{coupon:w.coupon,onChange:e=>z("coupon",e)}),(0,l.jsx)(u.A,{balance:!1,value:w.payment,onChange:e=>z("payment",e)})]})})}),(0,l.jsxs)(f.$,{className:"w-full",size:"lg",disabled:!P.valid||C,onClick:E,children:[C&&(0,l.jsx)(b.A,{className:"mr-2 animate-spin"}),r("buyNow")]})]})]}):(0,l.jsx)("div",{className:"p-6 text-center",children:r("subscriptionNotFound")})}},28454:(e,t,r)=>{"use strict";r.d(t,{z:()=>a});var l=r(42289),n=r(72511),i=r(54577),s=r(86645);function a(e){let{suffix:t,prefix:r,formatInput:a,formatOutput:u,value:o,className:c,onValueChange:d,onValueBlur:f,...p}=e,m=e=>{if(""===e||0===e||"0"===e)return"";let t=String(null!=e?e:"");return a?a(e):t},[x,v]=(0,s.useState)(()=>m(o)),[h,b]=(0,s.useState)(null!=o?o:"");(0,s.useEffect)(()=>{if(o!==h){let e=m(o);x!==e&&(v(e),b(null!=o?o:""))}},[o,a]);let g=e=>{let t=null==e?void 0:e.toString().trim();return"0"===t&&"number"===p.type?u?u(0):0:(t&&"number"===p.type&&(t=Number(t)),u?u(t):t)};return(0,l.jsxs)("div",{className:(0,i.cn)("border-input flex w-full items-center overflow-hidden rounded-md border",c),suppressHydrationWarning:!0,children:["string"==typeof r?(0,l.jsx)("div",{className:"bg-muted relative mr-px flex h-9 items-center text-nowrap px-3",children:r}):r,(0,l.jsx)(n.p,{step:.01,autoComplete:"off",...p,value:x,className:"block rounded-none border-none",onChange:e=>{let t=e.target.value;if("number"===p.type){if("0"===t){v(""),b(0),null==d||d(g(0));return}if(/^-?\d*\.?\d*$/.test(t)||"-"===t||"."===t){let e=Number(t);if(isNaN(e)||"-"===t||"."===t)b(t);else{let r=Math.max(Number.isFinite(p.min)?p.min:-1/0,Math.min(Number.isFinite(p.max)?p.max:1/0,e));t=String(r),b(r)}v("0"===t?"":t)}}else v(t),b(t);let r=g(t);null==d||d(r)},onBlur:()=>{if("number"===p.type&&x){if("-"===x||"."===x){v(""),b(""),null==f||f("");return}if("0"===x){v(""),null==f||f(g(0));return}}let e=g(x);(o||"")!==e&&(null==f||f(e))}}),"string"==typeof t?(0,l.jsx)("div",{className:"bg-muted relative ml-px flex h-9 items-center text-nowrap px-3",children:t}):t]})}},31849:(e,t,r)=>{"use strict";r.d(t,{b:()=>o});var l=r(86645),n=r(70900),i=r(42289),s="horizontal",a=["horizontal","vertical"],u=l.forwardRef((e,t)=>{var r;let{decorative:l,orientation:u=s,...o}=e,c=(r=u,a.includes(r))?u:s;return(0,i.jsx)(n.sG.div,{"data-orientation":c,...l?{role:"none"}:{"aria-orientation":"vertical"===c?c:void 0,role:"separator"},...o,ref:t})});u.displayName="Separator";var o=u},33966:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});var l=r(86645);function n(e){let t=l.useRef({value:e,previous:e});return l.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}},43486:(e,t,r)=>{"use strict";r.d(t,{X:()=>i});var l=r(86645),n=r(59500);function i(e){let[t,r]=l.useState(void 0);return(0,n.N)(()=>{if(e){r({width:e.offsetWidth,height:e.offsetHeight});let t=new ResizeObserver(t=>{let l,n;if(!Array.isArray(t)||!t.length)return;let i=t[0];if("borderBoxSize"in i){let e=i.borderBoxSize,t=Array.isArray(e)?e[0]:e;l=t.inlineSize,n=t.blockSize}else l=e.offsetWidth,n=e.offsetHeight;r({width:l,height:n})});return t.observe(e,{box:"border-box"}),()=>t.unobserve(e)}r(void 0)},[e]),t}},58237:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"useMergedRef",{enumerable:!0,get:function(){return n}});let l=r(86645);function n(e,t){let r=(0,l.useRef)(null),n=(0,l.useRef)(null);return(0,l.useCallback)(l=>{if(null===l){let e=r.current;e&&(r.current=null,e());let t=n.current;t&&(n.current=null,t())}else e&&(r.current=i(e,l)),t&&(n.current=i(t,l))},[e,t])}function i(e,t){if("function"!=typeof e)return e.current=t,()=>{e.current=null};{let r=e(t);return"function"==typeof r?r:()=>e(null)}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},97034:(e,t,r)=>{"use strict";function l(){return(l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var l in r)({}).hasOwnProperty.call(r,l)&&(e[l]=r[l])}return e}).apply(null,arguments)}r.d(t,{default:()=>s});var n=r(86645),i=r(92515);function s(e){let{locale:t,...r}=e;if(!t)throw Error("Failed to determine locale in `NextIntlClientProvider`, please provide the `locale` prop explicitly.\n\nSee https://next-intl.dev/docs/configuration#locale");return n.createElement(i.IntlProvider,l({locale:t},r))}}},e=>{e.O(0,[7162,6318,3607,9077,6976,385,3241,5242,9247,1956,3769,1098,3158,4445,3367,7358],()=>e(e.s=14879)),_N_E=e.O()}]);